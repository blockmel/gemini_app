<!DOCTYPE html>
<html>
<head>
    <title>KI-gestützte UX/UI-Optimierung</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="icon" type="image/png" href="/static/ki_gestuetzte_ux_ui_optimierung.png">
</head>
<body>
    <div class="header">
        <img src="/static/ki_gestuetzte_ux_ui_optimierung.png" alt="Logo KI-gestützte UX/UI-Optimierung" class="logo">
        <h1>KI-gestützte UX/UI-Optimierung</h1>
    </div>
    <form method="post" enctype="multipart/form-data">
        <div class="form-grid">
            <div class="form-left">
                <label for="file">Bild hochladen:</label>
                <input type="file" id="file" name="file" onchange="toggleFields()">
                <div class="button-wrapper">
                    <button type="button" id="removeImageButton" disabled="true" onclick="removeImage()">Bild entfernen</button>
                </div>
            </div>

            <div class="form-middle">
                <p>Oder</p>
            </div>

            <div class="form-right">
                <label for="url">Webseiten-URL eingeben:</label>
                <input type="url" id="url" name="url" oninput="toggleFields()">
                <div class="button-wrapper">
                    <button type="button" id="removeUrlButton" disabled="true" onclick="removeUrl()">URL entfernen</button>
                </div>
            </div>
        </div>

        <div class="form-submit">
            <input type="submit" id="submit" value="Absenden" disabled="true">
        </div>
    </form>

    {% if response and response.strip() %}
        <article class="response-container" aria-labelledby="antwort-überschrift">
            <h2 id="antwort-überschrift">Antwort:</h2>

            {% if image_data %}
                <div class="response-image">
                    <img src="data:image/png;base64,{{ image_data }}" alt="{% if file %}Hochgeladenes Bild zur Analyse{% else %}Screenshot der analysierten Webseite{% endif %}" tabindex="0">
                </div>
            {% endif %}

            <div class="response-text" role="region" aria-label="Analyseergebnis" tabindex="0">
                {% if response is string %}
                    {% for paragraph in response.split('\n\n') %}
                        {% if paragraph.strip().startswith('Allgemeines Feedback:') %}
                            <h3>Allgemeines Feedback:</h3>
                            <div class="indent">
                                <p>{{ paragraph[paragraph.find(':') + 1:] | replace('\n', '<br>') | safe }}</p>
                            </div>
                        {% elif paragraph.strip().startswith('Gefundene Farbkontrast-Probleme:') %}
                            <br><h3>Gefundene Farbkontrast-Probleme:</h3>
                        {% elif paragraph.strip().startswith('Keine konkreten Farbprobleme gefunden.') %}
                            <p><strong>{{ paragraph | replace('\n', '<br>') | safe }}</strong></p>
                        {% elif paragraph.strip().startswith('Problem') and ':' in paragraph %}
                            {% set raw = paragraph.split(':', 1)[1] %}
                            {% set current = (raw.split('Aktueller Farbwert:')[1].split(',')[0].strip()) if 'Aktueller Farbwert:' in raw else None %}
                            {% set suggested = (raw.split('Verbesserung:')[1].strip()) if 'Verbesserung:' in raw else None %}
                            {% set problem_text = raw.split('Hier liegt das Problem:')[0].strip() %}
                            {% set location_text = raw.split('Hier liegt das Problem:')[1].split('Aktueller Farbwert:')[0].strip() %}
                            <div class="indent">
                                <p>
                                    <strong>{{ paragraph.split(':', 1)[0] }}:</strong><br>
                                    {{ problem_text }}<br>
                                    Hier liegt das Problem: {{ location_text }}<br>
                                    Aktueller Farbwert: 
                                    <span style="display: inline-flex; align-items: center; gap: 0.3em;">
                                        <span style="width: 0.9em; height: 0.9em; border-radius: 50%; background-color: {{ current }}; border: 1px solid #000;"></span>
                                        <span>{{ current }}</span>
                                    </span>, 
                                    Verbesserung: 
                                    <span style="display: inline-flex; align-items: center; gap: 0.3em;">
                                        <span style="width: 0.9em; height: 0.9em; border-radius: 50%; background-color: {{ suggested }}; border: 1px solid #000;"></span>
                                        <span>{{ suggested }}</span>
                                    </span>
                                </p>
                            </div>
                        {% else %}
                            <div class="indent">
                                <p>{{ paragraph | replace('\n', '<br>') | safe }}</p>
                            </div>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <p>Fehler: Antwort ist nicht im erwarteten Format.</p>
                {% endif %}
            </div>
        </article>
    {% endif %}



    <script>
        function toggleFields() {
            const fileInput = document.getElementById('file');
            const urlInput = document.getElementById('url');
            const submitButton = document.getElementById('submit');
            const removeImageButton = document.getElementById('removeImageButton');
            const removeUrlButton = document.getElementById('removeUrlButton');

            if (fileInput.files.length > 0) {
                urlInput.disabled = true;
                submitButton.disabled = false;
                removeImageButton.disabled = false;
            } else if (urlInput.value.trim() !== "") {
                fileInput.disabled = true;
                submitButton.disabled = false;
                removeUrlButton.disabled = false;
            } else {
                fileInput.disabled = false;
                urlInput.disabled = false;
                submitButton.disabled = true;
                removeImageButton.disabled = true;
                removeUrlButton.disabled = true;
            }
        }

        function removeImage() {
            const fileInput = document.getElementById('file');
            fileInput.value = '';
            toggleFields();
        }

        function removeUrl() {
            const urlInput = document.getElementById('url');
            urlInput.value = '';
            toggleFields();
        }

        window.addEventListener("DOMContentLoaded", function () {
            const response = document.querySelector('.response-container');
            if (response) {
                response.scrollIntoView({ behavior: 'smooth' });
            }

            document.querySelector("form").addEventListener("submit", function () {
                const responseContainer = document.querySelector(".response-container");
                if (responseContainer) {
                    responseContainer.remove();
                }

                const submitButton = document.getElementById("submit");
                const removeImageButton = document.getElementById('removeImageButton');
                const removeUrlButton = document.getElementById('removeUrlButton');
                submitButton.disabled = true;
                submitButton.value = "Wird verarbeitet...";
                removeImageButton.disabled = true;
                removeUrlButton.disabled = true;
            });
        });
    </script>
</body>
</html>
